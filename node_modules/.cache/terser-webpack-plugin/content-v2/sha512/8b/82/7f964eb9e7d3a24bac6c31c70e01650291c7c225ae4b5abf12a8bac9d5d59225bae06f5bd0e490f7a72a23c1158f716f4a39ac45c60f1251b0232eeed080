{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{209:function(e,t,a){\"use strict\";a.r(t);var s=a(4),n=a(56),i=a(6),r=a(1),o=a(0),l=a(70),c=a(3),u=a(2),d=a(13),h=a(12),p=a(59),g=a(26),b=a.n(g),m=a(116),j=a(20);class O extends o.Component{constructor(e){super(e),Object(i.a)(this,\"onCancel\",()=>{this.props.onChange(this.originalFile),this.setState({changeStatus:this.originalFile?\"stored\":\"empty\",dataURI:null,errorMessage:null})}),Object(i.a)(this,\"onRemove\",()=>{this.setState({changeStatus:\"removed\",errorMessage:null}),this.props.onChange(null)}),Object(i.a)(this,\"onChange\",e=>{let t=e.target,a=t.validity,s=Object(n.a)(t.files,1)[0];if(!s)return;const i=this.props,r=i.errorMessage,o=i.onChange,l={changeStatus:\"updated\"};a.valid?(s.type.includes(\"image\")?(this.getDataURI(s),l.oldImagePath=this.getImagePath()):this.state.dataURI&&this.setState({dataURI:null,errorMessage:null}),o(s),this.setState(l)):this.setState({errorMessage:r({type:\"save\"})})}),Object(i.a)(this,\"openFileBrowser\",()=>{this.inputRef&&this.inputRef.click()}),Object(i.a)(this,\"getFile\",()=>{const e=this.props.value,t=\"removed\"===this.state.changeStatus?this.originalFile:e;return{file:t,type:t&&t.__typename?\"server\":\"client\"}}),Object(i.a)(this,\"getDataURI\",e=>{const t=this.props.errorMessage,a=new FileReader;a.readAsDataURL(e),a.onloadstart=()=>{this.setState({isLoading:!0})},a.onerror=e=>{console.error(\"Error with Cloudinary preview\",e),this.setState({errorMessage:t({type:\"preview\"})})},a.onloadend=e=>{this.setState({isLoading:!1,dataURI:e.target.result})}}),Object(i.a)(this,\"getImagePath\",()=>{const e=this.state.dataURI,t=this.getFile().file;return t&&t.mimetype&&t.mimetype.includes(\"image\")?t.publicUrl:e}),Object(i.a)(this,\"getInputRef\",e=>{this.inputRef=e}),Object(i.a)(this,\"renderUploadButton\",()=>{const e=this.props.uploadButtonLabel,t=this.state,a=t.changeStatus,s=t.isLoading;return Object(r.e)(h.c,{onClick:this.openFileBrowser,isLoading:s,variant:\"ghost\"},e({status:a}))}),Object(i.a)(this,\"renderCancelButton\",()=>{const e=this.props.cancelButtonLabel,t=this.state.changeStatus;let a=\"warning\",s=this.onRemove;switch(t){case\"removed\":a=\"primary\",s=this.onCancel;break;case\"updated\":s=this.onCancel}return Object(r.e)(h.a,{onClick:s,variant:\"subtle\",appearance:a},e({status:t}))});const t=e.value;this.originalFile=t;const a=this.originalFile?\"stored\":\"empty\";this.state={changeStatus:a,dataURI:null,errorMessage:null,isLoading:!1,oldImagePath:null}}render(){const e=this.props,t=e.autoFocus,a=e.field,s=e.statusMessage,n=e.errors,i=this.state,o=i.changeStatus,c=i.errorMessage,d=this.getFile().file,h=this.getImagePath(),g=[\"removed\",\"updated\"].includes(o),b=\"ks-input-\".concat(a.path);return Object(r.e)(l.a,null,Object(r.e)(l.c,{htmlFor:b,field:a,errors:n}),Object(r.e)(l.b,null,d?Object(r.e)(f,null,h?Object(r.e)(R,{src:h,alt:a.path}):null,Object(r.e)(v,null,Object(r.e)(j.c,{style:{marginBottom:u.d}},this.renderUploadButton(),this.renderCancelButton()),c?Object(r.e)(y,null,c):Object(r.e)(j.c,{isInline:!0,growIndexes:[0]},Object(r.e)(w,{href:d.publicUrl},d.filename||d.name),g?Object(r.e)(S,{status:o},s({status:o})):null))):this.renderUploadButton(),Object(r.e)(p.b,{autoComplete:\"off\",autoFocus:t,id:b,innerRef:this.getInputRef,name:a.path,onChange:this.onChange,type:\"file\"})))}}Object(i.a)(O,\"propTypes\",{cancelButtonLabel:b.a.func.isRequired,disabled:b.a.bool,errorMessage:b.a.func.isRequired,field:b.a.object,onChange:b.a.func.isRequired,statusMessage:b.a.func.isRequired,uploadButtonLabel:b.a.func.isRequired}),Object(i.a)(O,\"defaultProps\",{cancelButtonLabel:function(e){switch(e.status){case\"stored\":return\"Remove File\";case\"removed\":return\"Undo Remove\";case\"updated\":default:return\"Cancel\"}},errorMessage:function(e){switch(e.type){case\"save\":return\"Something went wrong, please reload and try again.\";case\"preview\":return\"Something went wrong, please try again.\"}},statusMessage:function(e){switch(e.status){case\"removed\":return\"save to remove\";case\"updated\":return\"save to upload\"}},uploadButtonLabel:function(e){return\"empty\"===e.status?\"Upload File\":\"Change File\"}});const f=e=>Object(r.e)(\"div\",Object(c.a)({css:{alignItems:\"flex-start\",display:\"flex\"}},e)),v=e=>Object(r.e)(\"div\",Object(c.a)({css:{flex:1,minWidth:0}},e)),R=e=>Object(r.e)(\"div\",{css:{backgroundColor:\"white\",borderRadius:u.a,border:\"1px solid \".concat(u.b.N20),flexShrink:0,lineHeight:0,marginRight:u.d,padding:4,position:\"relative\",textAlign:\"center\",width:130}},Object(r.e)(\"img\",Object(c.a)({css:{height:\"auto\",maxWidth:\"100%\"}},e))),w=e=>Object(r.e)(m.a,Object(c.a)({crop:\"right\"},e)),y=e=>{let t=e.children,a=Object(s.a)(e,[\"children\"]);return Object(r.e)(m.a,Object(c.a)({style:{backgroundColor:u.b.R.L80,borderColor:\"transparent\",color:u.b.R.D20,display:\"inline-flex\"}},a),Object(r.e)(d.a,{css:{marginRight:u.d}}),t)},C={default:\"primary\",removed:\"danger\",updated:\"create\"},S=e=>{let t=e.status,a=void 0===t?\"default\":t,n=Object(s.a)(e,[\"status\"]);const i=C[a];return Object(r.e)(m.a,Object(c.a)({appearance:i},n))};t.default=O}}]);","extractedComments":[]}